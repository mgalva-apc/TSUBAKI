@model TSUBAKI.Models.ViewModel.BooksModel
@{
    ViewBag.Title = "ViewAppoint";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<h1>Booking Appointments List</h1>
<div>
    <span class="alert-success">@ViewBag.Message</span>
    <table class="table table-striped table-condensed table-hover">
        <thead>
            <tr>
                <th>Login Name</th>
                <th>Month</th>
                <th>Day</th>
                <th>Time Slot</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var i in Model.Appointments)
            {
                <tr>
                    <td>@Html.DisplayFor(m => i.LoginName)</td>
                    <td>@Html.DisplayFor(m => i.Month)</td>
                    <td>@Html.DisplayFor(m => i.Day)</td>
                    <td>@Html.DisplayFor(m => i.TimeSlot)</td>
                    <td><a href="#" class="lnkEdit" data-login="@i.LoginName" data-month="@i.Month" data-day="@i.Day" data-timeslot="@i.TimeSlot">Edit</a></td>
                </tr>
            }
        </tbody>
    </table>
</div>
<!-- The Modal -->
<div class="modal fade edit-modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Edit Appointment Schedule</h4>
                <button type="button" class="close close-modal" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <form>
                    <input type="hidden" id="editSchedId" />
                    <div class="form-group">
                        <label for="editLoginName">Login Name:</label>
                        <input type="text" class="form-control" id="editLoginName" readonly>
                    </div>
                    <div class="form-group">
                        <label for="editMonth">Month</label>
                        <select name="Month" id="editMonth">
                            <option value="JAN">January</option>
                            <option value="FEB">February</option>
                            <option value="MAR">March</option>
                            <option value="APR">April</option>
                            <option value="MAY">May</option>
                            <option value="JUN">June</option>
                            <option value="JUL">July</option>
                            <option value="AUG">August</option>
                            <option value="SEP">September</option>
                            <option value="OCT">October</option>
                            <option value="NOV">November</option>
                            <option value="DEC">December</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editDay">Day</label>
                            <select name="Day" id="editDay">
                                <option value="01">1</option>
                                <option value="02">2</option>
                                <option value="03">3</option>
                                <option value="04">4</option>
                                <option value="05">5</option>
                                <option value="06">6</option>
                                <option value="07">7</option>
                                <option value="08">8</option>
                                <option value="09">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                                <option value="21">21</option>
                                <option value="22">22</option>
                                <option value="23">23</option>
                                <option value="24">24</option>
                                <option value="25">25</option>
                                <option value="26">26</option>
                                <option value="27">27</option>
                                <option value="28">28</option>
                                <option value="29">29</option>
                                <option value="30">30</option>
                                <option value="31">31</option>
                            </select>
                    </div>
                    <div class="form-group">
                        <label for="editTimeSlot">Time Slots</label>
                            <select name="TimeSlot" id="editTimeSlot">
                                <option value="9:30AM - 11:30 AM">9:30 AM - 11:30 AM</option>
                                <option value="11:30AM - 1:30PM">11:30 AM - 1:30 PM</option>
                                <option value="3:30PM - 5:30PM">3:30 PM - 5:30 PM</option>
                            </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveChanges">Save Changes</button>
            </div>
        </div>
    </div>
</div>

<!-- Add JQuery links -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function () {
        var editModal = $(".edit-modal");
        var editSchedId = $("#editSchedId");
        var editLoginName = $("#editLoginName");
        var editMonth = $("#editMonth");
        var editDay = $("#editDay");
        var editTimeSlot = $("#editTimeSlot");

        // Click event for "Edit" links
        $(".lnkEdit").click(function () {
            var scheduleId = $(this).data("scheduleid");
            var loginName = $(this).data("login");
            var schedmonth = $(this).data("month");
            var schedday = $(this).data("day");
            var schedtime = $(this).data("timeslot");

            // Populate the modal with user data
            editSchedId.val(scheduleId);
            editLoginName.val(loginName);
            editMonth.val(schedmonth);
            editDay.val(schedday);
            editTimeSlot.val(schedtime);

            // Show the modal
            editModal.modal("show");
        });

        // Click event for "Save Changes" button
        $("#saveChanges").click(function () {

            // Create a JavaScript object with the updated user data
            var schedData = {
                LoginName: editLoginName.val(),
                Month: editMonth.val(),
                Day: editDay.val(),
                TimeSlot: editTimeSlot.val()
            };

            // Perform your update logic here (e.g., call an API or submit a form)
            // Make an AJAX request to your API endpoint to update user information
            $.ajax({
                type: "PUT", // Use the appropriate HTTP method (PUT, POST, etc.) for your API
                url: "/book/update", // Replace with your API endpoint URL (BEA NOTE: IDK WHAT TO CHANGE HERE)
                data: JSON.stringify(schedData),
                contentType: "application/json; charset=utf-8",
                success: function (response) {
                    // Handle the API response as needed
                    console.log("Schedule updated successfully");
                    window.location.reload();
                },
                error: function (error) {
                    // Handle API error
                    console.error("Error updating schedule:", error);
                    window.location.reload();
                }
            });

            // Close the modal
            editModal.modal("hide");
        });

        // Click event for "Close" button
        $(".close-modal").click(function () {
            editModal.modal("hide");
        });
    });

    // Function to reload the user list
    function reloadAppointmentList() {
        $.ajax({
            type: "GET", // Use the appropriate HTTP method for fetching the user list
            url: "/book/viewappoint", // Replace with your API endpoint URL to fetch the user list
            success: function (data) {
                // Replace the user list container with the updated user list HTML
                appointmentListContainer.html(data);
            },
            error: function (error) {
                console.error("Error fetching appointment list:", error);
            }
        });
    }
</script>